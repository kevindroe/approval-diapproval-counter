<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher Approval–Disapproval Counter</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; padding: 14px; background: #f6f7fb; color: #111; }
    .wrap { max-width: 1040px; margin: 0 auto; }

    /* Header */
    .header { display:flex; align-items:center; gap: 14px; flex-wrap: wrap; margin-bottom: 10px; }
    .logo { max-height: 76px; width: auto; }
    h1 { font-size: 22px; margin: 0; }
    .byline { margin: 2px 0 0; color:#444; font-size: 12.5px; }
    .sub { margin: 10px 0 14px; color: #444; font-size: 13px; line-height: 1.35; }

    /* Layout */
    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 920px) { .grid { grid-template-columns: 1.1fr .9fr; } }

    /* Cards + form */
    .card { background: #fff; border-radius: 14px; padding: 14px; box-shadow: 0 6px 24px rgba(0,0,0,.08); }
    label { display:block; font-size: 12px; color:#444; margin: 0 0 4px; }
    input[type="text"], input[type="date"], input[type="number"], textarea {
      width: 100%; box-sizing: border-box;
      padding: 10px 12px; border-radius: 10px; border: 1px solid #d7dbe8;
      background: #fff; font-size: 14px;
    }
    input[type="number"] { max-width: 180px; }
    textarea { min-height: 120px; resize: vertical; }

    .row { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 920px) { .row.two { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 920px) { .row.three { grid-template-columns: 1fr 1fr 1fr; } }

    /* Top area */
    .topbar { display:flex; align-items: flex-end; justify-content: space-between; gap: 12px; margin-top: 10px; flex-wrap: wrap; }
    .time { font-variant-numeric: tabular-nums; letter-spacing: .4px; }
    .big { font-size: 34px; font-weight: 900; }
    .pill { padding: 6px 10px; border-radius: 999px; background: #eef1ff; color: #2a3bb7; font-weight: 850; font-size: 12px; }
    .pill.off { background:#f0f2f8; color:#444; }
    .pill.on { background:#e9f7ef; color:#136a36; }

    /* Controls */
    .controls { display:flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
    button {
      border: 0; border-radius: 12px; padding: 10px 12px; font-weight: 850;
      cursor: pointer; background: #1e2330; color: #fff;
      touch-action: manipulation;
    }
    button.secondary { background: #e9ecf6; color: #111; }
    button.danger { background: #b11b2a; }
    button:disabled { opacity: .55; cursor:not-allowed; }

    /* Counters grid */
    .counters { display:grid; grid-template-columns: 1fr; gap: 10px; margin-top: 12px; }
    @media (min-width: 920px) { .counters { grid-template-columns: 1fr 1fr; } }

    .counterBox{
      border: 1px solid #e3e6f2;
      border-radius: 14px;
      padding: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .counterHead{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: start;
    }
    .name { font-weight: 950; }
    .desc { margin-top: 2px; font-size: 12px; color:#555; max-width: 52ch; }
    .count { font-size: 34px; font-weight: 950; font-variant-numeric: tabular-nums; text-align: right; }

    .btnrow { display:flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
    .btnrow button { padding: 10px 14px; }
    .bigTap { flex: 1 1 140px; min-width: 140px; }

    /* === Color requirement ===
       Approvals = green shade
       Disapprovals = red shade
    */
    .approve { background:#e6f7ea; border-color:#a9e0b5; }   /* light green */
    .disapprove { background:#fde8ea; border-color:#f3b1b7; }/* light red/pink */

    /* Export */
    #output { min-height: 240px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; background: #fbfcff; white-space: pre; }
    .kbd { font-family: ui-monospace, Menlo, Consolas, monospace; background:#f1f3fb; padding:2px 6px; border-radius:6px; border:1px solid #d7dbe8; }
    .footer { font-size: 12px; color:#555; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <!-- Put the PNG in the same folder as this HTML file (GitHub Pages: same repo folder as index.html) -->
      <img class="logo" src="Next%20Gen%20Music%20Ed%20logo.png" alt="Next Gen Music Ed logo">
      <div>
        <h1>Teacher Approval–Disapproval Counter</h1>
        <div class="byline">Developed by Kevin Droe, Ph.D.</div>
      </div>
    </div>

    <p class="sub">
      Count teacher responses <em>after students do something</em> (teacher is responding; neutral instructions don’t count).
    </p>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="row two">
          <div>
            <label for="observer">Student name (observer)</label>
            <input id="observer" type="text" placeholder="Student observer" />
          </div>
          <div>
            <label for="date">Date</label>
            <input id="date" type="date" />
          </div>
        </div>

        <div class="row three" style="margin-top:10px;">
          <div>
            <label for="teacher">Observed teacher</label>
            <input id="teacher" type="text" placeholder="Teacher (optional)" />
          </div>
          <div>
            <label for="context">Context</label>
            <input id="context" type="text" placeholder="Individual lesson / sectional / rehearsal" />
          </div>
          <div>
            <label for="duration">Observation length (minutes)</label>
            <input id="duration" type="number" min="1" step="1" value="10" />
          </div>
        </div>

        <div class="topbar">
          <div>
            <div style="font-size:12px; color:#555;">Elapsed time</div>
            <div id="elapsed" class="time big">00:00.0</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
            <span id="targetPill" class="pill">Target: 10:00</span>
            <span id="statePill" class="pill off">Stopped</span>
          </div>
        </div>

        <div class="controls">
          <button id="startBtn">Start</button>
          <button id="stopBtn" class="secondary">Stop</button>
          <button id="resetBtn" class="danger">Reset</button>
          <button id="exportBtn">Export summary</button>
        </div>

        <div class="counters" id="counters"></div>

        <div style="margin-top:12px;">
          <label for="notes">Notes</label>
          <textarea id="notes" placeholder="Optional: examples you heard/saw, what students did right before the response, patterns, etc."></textarea>
        </div>

        <div class="footer">
          Shortcuts: <span class="kbd">Space</span> Start/Stop •
          <span class="kbd">1</span> Music approval •
          <span class="kbd">2</span> Music disapproval •
          <span class="kbd">3</span> Social approval •
          <span class="kbd">4</span> Social disapproval •
          <span class="kbd">Z</span> undo last count •
          <span class="kbd">E</span> export
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <label for="output">Export (copy/paste into LMS or Google Form)</label>
        <textarea id="output" placeholder="Click “Export summary” to generate a clean text block."></textarea>

        <div class="controls">
          <button id="copyBtn" class="secondary">Copy to clipboard</button>
          <button id="downloadBtn" class="secondary">Download CSV</button>
        </div>

        <div class="footer">
          Tip: If students can’t click buttons, they’re likely in a “preview.” Use your GitHub Pages link or open in a normal browser tab.
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const categories = [
    {
      id: "musicApproval",
      label: "Music approval",
      desc: "Verbal/non-verbal approval for student musical behavior.",
      tone: "approve"
    },
    {
      id: "musicDisapproval",
      label: "Music disapproval",
      desc: "Verbal/non-verbal disapproval or correction for student musical behavior.",
      tone: "disapprove"
    },
    {
      id: "socialApproval",
      label: "Social approval",
      desc: "Verbal/non-verbal approval for student social behavior.",
      tone: "approve"
    },
    {
      id: "socialDisapproval",
      label: "Social disapproval",
      desc: "Verbal/non-verbal disapproval for student social behavior.",
      tone: "disapprove"
    }
  ];

  const state = {
    running: false,
    startPerf: null,
    elapsedMs: 0,
    raf: null,
    counts: Object.fromEntries(categories.map(c => [c.id, 0])),
    history: [] // {id, t}
  };

  // Elements
  const observerEl = document.getElementById("observer");
  const teacherEl = document.getElementById("teacher");
  const contextEl = document.getElementById("context");
  const dateEl = document.getElementById("date");
  const durationEl = document.getElementById("duration");
  const notesEl = document.getElementById("notes");

  const elapsedEl = document.getElementById("elapsed");
  const targetPillEl = document.getElementById("targetPill");
  const statePillEl = document.getElementById("statePill");

  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const resetBtn = document.getElementById("resetBtn");
  const exportBtn = document.getElementById("exportBtn");

  const countersEl = document.getElementById("counters");

  const outputEl = document.getElementById("output");
  const copyBtn = document.getElementById("copyBtn");
  const downloadBtn = document.getElementById("downloadBtn");

  dateEl.valueAsDate = new Date();

  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

  function formatMs(ms) {
    const totalTenths = Math.floor(ms / 100);
    const tenths = totalTenths % 10;
    const totalSeconds = Math.floor(totalTenths / 10);
    const s = totalSeconds % 60;
    const m = Math.floor(totalSeconds / 60);
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}.${tenths}`;
  }
  function formatMsNoTenths(ms) {
    const totalSeconds = Math.round(ms / 1000);
    const s = totalSeconds % 60;
    const m = Math.floor(totalSeconds / 60);
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }
  function msToSeconds(ms){ return Math.round(ms/1000); }

  function updateTargetPill() {
    const mins = clamp(parseInt(durationEl.value || "10", 10), 1, 999);
    targetPillEl.textContent = `Target: ${formatMsNoTenths(mins * 60 * 1000)}`;
  }
  durationEl.addEventListener("change", updateTargetPill);
  updateTargetPill();

  function setRunUI() {
    statePillEl.textContent = state.running ? "Running" : "Stopped";
    statePillEl.className = `pill ${state.running ? "on" : "off"}`;
    startBtn.disabled = state.running;
    stopBtn.disabled = !state.running;
  }

  function renderCounters() {
    countersEl.innerHTML = "";
    categories.forEach((c, idx) => {
      const box = document.createElement("div");
      box.className = `counterBox ${c.tone}`;
      box.id = `box-${c.id}`;

      const head = document.createElement("div");
      head.className = "counterHead";

      const left = document.createElement("div");
      left.innerHTML = `
        <div class="name">${idx + 1}. ${c.label}</div>
        <div class="desc">${c.desc}</div>
      `;

      const right = document.createElement("div");
      right.style.display = "grid";
      right.style.gap = "8px";
      right.style.justifyItems = "end";

      const count = document.createElement("div");
      count.className = "count";
      count.id = `count-${c.id}`;
      count.textContent = String(state.counts[c.id]);

      const btnRow = document.createElement("div");
      btnRow.className = "btnrow";

      const plus = document.createElement("button");
      plus.className = "bigTap";
      plus.textContent = "+1";
      plus.addEventListener("click", () => increment(c.id));

      const minus = document.createElement("button");
      minus.textContent = "-1";
      minus.className = "secondary";
      minus.addEventListener("click", () => decrement(c.id));

      btnRow.appendChild(plus);
      btnRow.appendChild(minus);

      right.appendChild(count);
      right.appendChild(btnRow);

      head.appendChild(left);
      head.appendChild(right);

      box.appendChild(head);
      countersEl.appendChild(box);
    });
  }

  function paintCounts() {
    categories.forEach(c => {
      const el = document.getElementById(`count-${c.id}`);
      if (el) el.textContent = String(state.counts[c.id]);
    });
  }

  function increment(id) {
    state.counts[id] += 1;
    state.history.push({ id, t: Date.now() });
    paintCounts();
  }

  function decrement(id) {
    state.counts[id] = Math.max(0, state.counts[id] - 1);
    paintCounts();
  }

  function undoLast() {
    const last = state.history.pop();
    if (!last) return;
    state.counts[last.id] = Math.max(0, state.counts[last.id] - 1);
    paintCounts();
  }

  function tick(now) {
    if (!state.running) return;
    if (state.startPerf == null) state.startPerf = now;

    const dt = now - state.startPerf;
    state.startPerf = now;
    state.elapsedMs += dt;

    elapsedEl.textContent = formatMs(state.elapsedMs);

    const mins = clamp(parseInt(durationEl.value || "10", 10), 1, 999);
    const targetMs = mins * 60 * 1000;

    if (state.elapsedMs >= targetMs) {
      stop();
      state.elapsedMs = targetMs;
      elapsedEl.textContent = formatMs(state.elapsedMs);
    } else {
      state.raf = requestAnimationFrame(tick);
    }
  }

  function start() {
    if (state.running) return;
    state.running = true;
    state.startPerf = null;
    setRunUI();
    state.raf = requestAnimationFrame(tick);
  }

  function stop() {
    if (!state.running) return;
    state.running = false;
    if (state.raf) cancelAnimationFrame(state.raf);
    state.raf = null;
    state.startPerf = null;
    setRunUI();
  }

  function resetAll() {
    stop();
    state.elapsedMs = 0;
    elapsedEl.textContent = formatMs(0);
    for (const k of Object.keys(state.counts)) state.counts[k] = 0;
    state.history = [];
    paintCounts();
    outputEl.value = "";
    notesEl.value = "";
  }

  function exportSummary() {
    if (state.running) stop();

    const observer = observerEl.value.trim();
    const teacher = teacherEl.value.trim();
    const context = contextEl.value.trim();
    const dateVal = dateEl.value;

    const mins = clamp(parseInt(durationEl.value || "10", 10), 1, 999);
    const targetMs = mins * 60 * 1000;

    const lines = [];
    lines.push("TEACHER APPROVAL–DISAPPROVAL COUNTER");
    lines.push("-----------------------------------");
    lines.push("Developed by Kevin Droe, Ph.D.");
    lines.push("");
    if (observer) lines.push(`Student observer: ${observer}`);
    if (dateVal) lines.push(`Date: ${dateVal}`);
    if (teacher) lines.push(`Observed teacher: ${teacher}`);
    if (context) lines.push(`Context: ${context}`);
    lines.push(`Target time: ${formatMsNoTenths(targetMs)}`);
    lines.push(`Observed time: ${formatMsNoTenths(state.elapsedMs)}`);
    lines.push("");

    lines.push("Counts (#):");
    lines.push(`1. Musical approvals: ${state.counts.musicApproval}`);
    lines.push(`2. Musical disapprovals: ${state.counts.musicDisapproval}`);
    lines.push(`3. Social approvals: ${state.counts.socialApproval}`);
    lines.push(`4. Social disapprovals: ${state.counts.socialDisapproval}`);

    const notes = notesEl.value.trim();
    if (notes) {
      lines.push("");
      lines.push("Notes:");
      lines.push(notes);
    }

    lines.push("");
    lines.push("One-line version (for Google Form short answer):");
    const one = [
      observer ? `Student=${observer}` : null,
      dateVal ? `Date=${dateVal}` : null,
      teacher ? `Teacher=${teacher}` : null,
      context ? `Context=${context}` : null,
      `Time=${formatMsNoTenths(state.elapsedMs)}`,
      `MusicApproval=${state.counts.musicApproval}`,
      `MusicDisapproval=${state.counts.musicDisapproval}`,
      `SocialApproval=${state.counts.socialApproval}`,
      `SocialDisapproval=${state.counts.socialDisapproval}`
    ].filter(Boolean).join(" | ");
    lines.push(one);

    outputEl.value = lines.join("\n");
  }

  function downloadCSV() {
    if (state.running) stop();

    const headers = [
      "student_observer",
      "date",
      "observed_teacher",
      "context",
      "target_mmss",
      "observed_mmss",
      "music_approvals",
      "music_disapprovals",
      "social_approvals",
      "social_disapprovals",
      "notes"
    ];

    const mins = clamp(parseInt(durationEl.value || "10", 10), 1, 999);
    const targetMs = mins * 60 * 1000;

    const values = [
      observerEl.value.trim(),
      dateEl.value,
      teacherEl.value.trim(),
      contextEl.value.trim(),
      formatMsNoTenths(targetMs),
      formatMsNoTenths(state.elapsedMs),
      state.counts.musicApproval,
      state.counts.musicDisapproval,
      state.counts.socialApproval,
      state.counts.socialDisapproval,
      notesEl.value.trim()
    ];

    const esc = (s) => {
      const str = (s ?? "").toString();
      if (/[",\n]/.test(str)) return `"${str.replace(/"/g, '""')}"`;
      return str;
    };

    const csv = `${headers.join(",")}\n${values.map(esc).join(",")}\n`;
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    const safe = (dateEl.value || "observation").replace(/[^0-9a-z]+/gi, "_");
    a.href = url;
    a.download = `approval_disapproval_${safe}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // Buttons
  startBtn.addEventListener("click", start);
  stopBtn.addEventListener("click", stop);
  resetBtn.addEventListener("click", resetAll);
  exportBtn.addEventListener("click", exportSummary);

  // Copy + Download
  document.getElementById("copyBtn").addEventListener("click", async () => {
    const text = outputEl.value.trim();
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = "Copied!";
      setTimeout(() => (copyBtn.textContent = "Copy to clipboard"), 900);
    } catch {
      outputEl.focus();
      outputEl.select();
      document.execCommand("copy");
      copyBtn.textContent = "Copied!";
      setTimeout(() => (copyBtn.textContent = "Copy to clipboard"), 900);
    }
  });
  downloadBtn.addEventListener("click", downloadCSV);

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
    if (tag === "input" || tag === "textarea") return;

    if (e.code === "Space") { e.preventDefault(); state.running ? stop() : start(); return; }
    if (e.key === "1") increment("musicApproval");
    if (e.key === "2") increment("musicDisapproval");
    if (e.key === "3") increment("socialApproval");
    if (e.key === "4") increment("socialDisapproval");
    if (e.key.toLowerCase() === "z") undoLast();
    if (e.key.toLowerCase() === "e") exportSummary();
  });

  // init
  renderCounters();
  paintCounts();
  setRunUI();
})();
</script>
</body>
</html>
